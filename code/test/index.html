<!DOCTYPE html>
<html>
<head>
<link href="http://fonts.googleapis.com/css?family=Roboto+Slab:700|Open+Sans:300italic,400,300,600,600italic" rel="stylesheet" type="text/css">
</head>
<body>


<p >Dear Clinton,</p>

<p  style="font-size:16px;font-family: 'open sans',Helvetica,'sans serif';">Thank you for the lovely post.  Here is a copy of the neistat brothers HBO show on DVD.  It originally aired in the summer of 2010.</p>

<p style="border:solid 1px;">Servidor de usted,</p>

<h2 style="border:solid 1px">--van</h2>

<p>some dummy untyped content</p>

<hr>

<p class="analogue">Dear Clinton,</p>

<p class="analogue" style="font-size:16px;font-family: 'open sans',Helvetica,'sans serif';">Thank you for the lovely post.  Here is a copy of the neistat brothers HBO show on DVD.  It originally aired in the summer of 2010.</p>

<p class="analogue" style="border:solid 1px">Servidor de usted,</p>

<h2 class="analogue" style="border:solid 1px">--van</h2>


<script>
/**
 * Copyright (c) Clinton Freeman 2015
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and
 * associated documentation files (the "Software"), to deal in the Software without restriction,
 * including without limitation the rights to use, copy, modify, merge, publish, distribute,
 * sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all copies or
 * substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT
 * NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

// TODO: multi-line paragraphs.
// TODO: Render random correction tape behind some sections of the text.
// TODO: The ability to set foreground and background colours.
// TODO: Make typo ink strike a bit softer than accurate strikes.
// TODO: Text is not correctly aligned vertically within the canvas (a little high) + magic number.
// TODO: Margins are not being copied correctly in firefox developer edition. 

var smudge = ["q", "r", "o", "p", "a", "d", "b", "4", "6", "8", "9", "0", "@", "%", "&"];

function rand(s, e) {
	return Math.floor((Math.random() * e) + s) | 0;
}

function chance(p) {
	if (rand(0, 100) >= (100 - p)) {
		return true;
	}

	return false;
}

function generateInkStrike(ctx, s, w, h) {
	var hLower = (h * 0.7 | 0);
	var hUpper = h;

	var wLower = s;
	var wUpper = w;

	var hGradient = rand(hLower, hUpper);
	var wGradient = rand(wLower, wUpper);

	// console.log("hLower: " + hLower);
	// console.log("hUpper: " + hUpper);
	// console.log("wLower: " + wLower);
	// console.log("wUpper: " + wUpper);
	// console.log("hGradient " + hGradient);
	// console.log("wGradient " + wGradient);

	var res = ctx.createLinearGradient(s, 0, wGradient, hGradient);
	res.addColorStop(0,"black");
	res.addColorStop(1,"rgb(190,190,190)");
	return res;
}

function typeCharacter(ctx, c, nc, s, h) {
	var w = ctx.measureText(c).width | 0;

	// render smudges / deepened bleed for characters with enclosing strokes.
	if (smudge.indexOf(c.toLowerCase()) != -1 && chance(10)) {
		// console.log("s: " + s);
		// console.log("h: " + h);
		// console.log("width: " + w);
		// console.log("height: " + h);

		var grd=ctx.createRadialGradient(s+rand(w/3,w/2), 8,1, s+rand(w/3,w/2),8, w/2+1);
		var g = rand(120, 220);
		grd.addColorStop(0,"rgb("+g+","+g+","+g+")");
		grd.addColorStop(1,"white");
		ctx.fillStyle=grd;
		ctx.fillRect(s, 0, w, 19); 
	}	

	// render transposition typographical errors. 
	if (c != " " && nc && chance(2)) {
		ctx.fillStyle=generateInkStrike(ctx, s, w, h);// approximate type bar strike.
		ctx.fillText(nc, s, w+5+rand(0,2));
	}

	ctx.fillStyle=generateInkStrike(ctx, s, w, h);// approximate type bar strike.
	ctx.fillText(c, s, w+5+rand(0,2));			  // render foundation character.
	ctx.fillText(c, s+rand(0, 1), w+5+rand(0,2)); // bleed character onto the page.

	return w;
}

function typeParagraph(eExisting) {
	// Create canvas element that we will use to re-render the content off the existing element.
	var eCanvas = document.createElement("canvas");
	var existingStyle = eExisting.currentStyle || window.getComputedStyle(eExisting);

	// Model the width and the height of the canvas off the existing element.
	eCanvas.setAttribute("width", eExisting.offsetWidth);
	eCanvas.setAttribute("height", eExisting.offsetHeight);

	// Copy the basic display settings across.
	eCanvas.style.border = existingStyle.border;
	eCanvas.style.display = existingStyle.display;
	eCanvas.style.margin = existingStyle.margin;
	eCanvas.style.padding = existingStyle.padding;

	//eCanvas.innerHTML = 'Your browser does not support the HTML5 canvas tag.';

	// Model the size of the type off the existing element.
	var fSize = parseFloat(existingStyle.getPropertyValue('font-size'));

	// Configure our canvas rendering context.
	var ctx = eCanvas.getContext("2d");
	ctx.font = fSize + "px \"Courier New\",monospace";

	// Start pecking away at our virtual typewritter.
	var p = 0;
	for(var i = 0, len = eExisting.innerHTML.length; i < len; i++) {
		p = p + typeCharacter(ctx, eExisting.innerHTML[i], eExisting.innerHTML[i+1], p, fSize);
	}

	eExisting.parentNode.insertBefore(eCanvas, eExisting);
	eExisting.style.display = 'none'; // Hide the original content. The canvas has replaced it.
}

aTypingList = document.querySelectorAll(".analogue");
for (var i = 0, len = aTypingList.length; i < len; i++) {
	typeParagraph(aTypingList[i])
}
</script>

</body>
</html>